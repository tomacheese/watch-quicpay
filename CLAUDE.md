# CLAUDE.md

## 目的
Claude Code の作業方針とプロジェクト固有ルールを示す。

## 判断記録のルール
- 判断内容の要約
- 検討した代替案
- 採用しなかった案とその理由
- 前提条件・仮定・不確実性
- 他エージェントによるレビュー可否

## プロジェクト概要
- 目的: QUICPay キャンペーン情報の監視と Discord 通知。
- 主な機能: キャンペーン一覧の取得、新規項目の判定、Discord への通知。

## 重要ルール
- 会話は日本語で行う。
- コミットメッセージは Conventional Commits に従い、説明は日本語とする。
- コード内のコメントは日本語で記載する。
- エラーメッセージは英語で記載する。

## 環境のルール
- ブランチ命名は Conventional Branch (`feat/`, `fix/` など) に従う。
- GitHub リポジトリの調査が必要な場合は、テンポラリディレクトリにクローンして行う。
- Renovate が作成した PR に対して、追加コミットや更新を行わない。

## コード改修時のルール
- 日本語と英数字の間には半角スペースを入れる。
- エラーメッセージに絵文字が含まれている場合は、全体で絵文字の設定を統一する。
- TypeScript の `skipLibCheck` を有効にして回避しない。
- インターフェースには JSDoc を日本語で記載する（関数への JSDoc 記載は今後の方針として推奨）。

## 相談ルール
- Codex CLI: 実装レビュー、局所設計、整合性確認。
- Gemini CLI: 外部仕様、最新情報確認。
- 指摘への対応ルール: 指摘された内容は真摯に受け止め、黙殺しない。

## 開発コマンド
```bash
# 依存関係のインストール
pnpm install

# 実行
pnpm start

# 開発モード
pnpm dev

# テスト
pnpm test

# リンター
pnpm lint

# 修正
pnpm fix
```

## アーキテクチャと主要ファイル
- `src/main.ts`: エントリーポイント。全体のフロー制御。
- `src/quicpay-campaigns.ts`: キャンペーン情報の取得ロジック。
- `src/discord.ts`: Discord 通知関連の処理。
- `src/config.ts`: 設定の読み込み。
- `src/notified.ts`: 通知済み情報の永続化管理。

## 実装パターン
- 推奨: `axios` と `cheerio` を組み合わせたスクレイピング。
- 非推奨: 大規模なスクレイピングフレームワークの導入（本プロジェクトには過剰）。

## テスト
- Jest を使用。
- スクレイピング結果のパースロジックなどは積極的にテストを書く。

## 作業チェックリスト

### 新規改修時
1. プロジェクトを理解する。
2. 作業ブランチが適切であることを確認する。
3. 最新のリモートブランチに基づいた新規ブランチであることを確認する。
4. 指定されたパッケージマネージャー (pnpm) で依存関係をインストールする。

### コミット・プッシュ前
1. Conventional Commits に従っていることを確認する。
2. センシティブな情報（Webhook URL 等）が含まれていないことを確認する。
3. `pnpm lint` でエラーがないことを確認する。
4. `pnpm test` で動作確認を行う。

### PR 作成前
1. PR 作成の依頼があることを確認する。
2. コンフリクトの恐れがないことを確認する。

### PR 作成後
1. コンフリクトがないことを確認する。
2. PR 本文が最新状態のみを網羅していることを確認する。
3. `gh pr checks <PR ID> --watch` で CI を確認する。
